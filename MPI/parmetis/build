#!/usr/bin/env modbuild

pbuild::set_download_url "http://glaros.dtc.umn.edu/gkhome/fetch/sw/$P/$P-$V.tar.gz"

pbuild::add_to_group 'MPI'

case ${V_MAJOR} in
3 )
	pbuild::add_docfiles CHANGES INSTALL LICENSE.txt README VERSION
	;;
4 )
	pbuild::add_docfiles Changelog Install.txt LICENSE.txt
	;;
* )
	std::die 4 "Unsupported major version!"
	;;
esac

pbuild::pre_configure() {
	pbuild::add_configure_args "CC=${MPICC}"
	pbuild::add_configure_args "CXX=${MPICXX}"
	pbuild::add_configure_args "F77=${MPIF77}"
	pbuild::add_configure_args "F90=${MPIF90}"
	pbuild::add_configure_args "FC=${MPIFC}"
	pbuild::add_configure_args "FORTRAN=${MPIFORTRAN}"
	if ((  V_MAJOR == 4 )}; then
		pbuild::add_configure_args "-DMETIS_PATH=${SRC_DIR}/metis"
		pbuild::add_configure_args "-DGKLIB_PATH=${SRC_DIR}/metis/GKlib"
		;;
	fi
}

pbuild::pre_install() {
	mkdir -p "${PREFIX}/include/metis"
	mkdir -p "${PREFIX}/lib"
}

pbuild::post_install() {
	case ${V_MAJOR} in
	3 )
		cd "${SRC_DIR}"
		cp *.h $PREFIX/include
		cp METISLib/*.h $PREFIX/include/metis
		cp lib*.a $PREFIX/lib
		;;
	4 )
		LIBMETIS_A=$(find . -name libmetis.a)
		METIS_H=$(find "${SRC_DIR}" -name metis.h)

		install -m 0644 $METIS_H    $PREFIX/include
		install -m 0644 $LIBMETIS_A $PREFIX/lib
		;;
	esac
}

# vim: filetype=sh

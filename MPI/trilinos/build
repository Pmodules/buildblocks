#!/usr/bin/env modbuild

pbuild::configure(){

	config_args+=( "-DBLAS_LIBRARY_DIRS:PATH=${OPENBLAS_PREFIX}/lib" )
	config_args+=( "-DBLAS_INCLUDE_DIRS:PATH=${OPENBLAS_PREFIX}/include" )
	config_args+=( "-DBLAS_LIBRARY_NAMES:STRING=openblas" )
	config_args+=( "-DLAPACK_LIBRARY_DIRS:PATH=${OPENBLAS_PREFIX}/lib" )
	config_args+=( "-DLAPACK_INCLUDE_DIRS:PATH=${OPENBLAS_PREFIX}/include" )
	config_args+=( "-DLAPACK_LIBRARY_NAMES:STRING=openblas" )
        config_args+=( "-DTPL_METIS_INCLUDE_DIRS:PATH=${PARMETIS_PREFIX}/include" )
	config_args+=( "-DTPL_METIS_LIBRARIES:STRING=${PARMETIS_PREFIX}/lib/libmetis.a" )
	config_args+=( "-DTPL_ParMETIS_INCLUDE_DIRS:PATH=${PARMETIS_PREFIX}/include" )
	config_args+=( "-DTPL_ParMETIS_LIBRARIES:STRING=${PARMETIS_PREFIX}/lib/libparmetis.a" )
	#CFLAGS="-Wno-error=implicit-function-declaration"
	#	-DCMAKE_C_FLAGS="{CFLAGS}" \
	CC=mpicc CXX=mpicxx cmake \
		-DCMAKE_INSTALL_PREFIX:PATH="${PREFIX}" \
	        -DCMAKE_CXX_FLAGS:STRING="-DMPICH_IGNORE_CXX_SEEK -fPIC" \
		-DCMAKE_C_FLAGS:STRING="-DMPICH_IGNORE_CXX_SEEK -fPIC" \
		-DCMAKE_BUILD_TYPE:STRING=Release \
		-DTrilinos_WARNINGS_AS_ERRORS_FLAGS:STRING="" \
		-DCMAKE_CXX_STANDARD=17 \
                -DGtest_SKIP_INSTALL:BOOL=ON \
	        -DTPL_ENABLE_DLlib:BOOL=OFF \
	        -DTPL_ENABLE_QT:BOOL=OFF \
	        -DTPL_ENABLE_MPI:BOOL=ON \
	        -DTPL_ENABLE_BLAS:BOOL=ON \
	        -DTPL_ENABLE_LAPACK:BOOL=ON \
	        -DTPL_ENABLE_METIS:BOOL=ON \
                -DTPL_ENABLE_ParMETIS:BOOL=ON \
                -DTrilinos_ENABLE_Amesos:BOOL=ON \
                -DTrilinos_ENABLE_Amesos2:BOOL=ON \
                -DTrilinos_ENABLE_AztecOO:BOOL=ON \
 		-DAztecOO_DISABLE_STRONG_WARNINGS:BOOL=ON \
                -DTrilinos_ENABLE_Belos:BOOL=ON \
                -DTrilinos_ENABLE_Epetra:BOOL=ON \
                -DTrilinos_ENABLE_EpetraExt:BOOL=ON \
                -DTrilinos_ENABLE_Galeri:BOOL=ON \
                -DTrilinos_ENABLE_Ifpack:BOOL=ON \
                -DTrilinos_ENABLE_Ifpack2:BOOL=ON \
                -DTrilinos_ENABLE_Isorropia:BOOL=ON \
                -DTrilinos_ENABLE_Kokkos:BOOL=ON \
                -DTrilinos_ENABLE_ML:BOOL=ON \
                -DTrilinos_ENABLE_NOX:BOOL=ON \
		-DTrilinos_ENABLE_MueLu:BOOL=ON \
                -DTrilinos_ENABLE_Optika:BOOL=OFF \
                -DTrilinos_ENABLE_Teuchos:BOOL=ON \
                -DTrilinos_ENABLE_Tpetra:BOOL=ON \
                -DTpetra_INST_COMPLEX_DOUBLE:BOOL=OFF \
                -DTpetra_INST_COMPLEX_FLOAT:BOOL=OFF \
                -DTpetra_INST_CUDA:BOOL=OFF \
                -DTpetra_INST_DD_REAL:BOOL=OFF \
                -DTpetra_INST_DOUBLE:BOOL=ON \
                -DTpetra_INST_FLOAT:BOOL=OFF \
                -DTpetra_INST_FLOAT128:BOOL=OFF \
                -DTpetra_INST_HIP:BOOL=OFF \
                -DTpetra_INST_INT_INT:BOOL=OFF \
                -DTpetra_INST_INT_LONG:BOOL=ON \
                -DTpetra_INST_INT_LONG_LONG:BOOL=OFF \
                -DTpetra_INST_INT_UNSIGNED:BOOL=OFF \
                -DTpetra_INST_INT_UNSIGNED_LONG:BOOL=OFF \
                -DTpetra_INST_LONG_DOUBLE:BOOL=OFF \
		-DTrilinos_ENABLE_Zoltan2:BOOL=ON \
                -DTrilinos_ENABLE_TESTS:BOOL=OFF \
                "${config_args[@]}" \
                "${SRC_DIR}" || exit 1
}

pbuild::configurei-12(){
	declare config_args=()
	BLAS_PREFIX="${OPENBLAS_PREFIX}"
	BLAS_INCLUDE_DIRS="${BLAS_PREFIX}/include"
	BLAS_LIBRARY_DIRS="${BLAS_PREFIX}/lib"
	BLAS_LIBRARY_NAMES="openblas"
	LAPACK_PREFIX="${OPENBLAS_PREFIX}"

	LAPACK_INCLUDE_DIRS="${LAPACK_PREFIX}/include"
	LAPACK_LIBRARY_DIRS="${LAPACK_PREFIX}/lib"
	LAPACK_LIBRARY_NAMES="openblas"
	config_args+=( "-DBLAS_LIBRARY_DIRS:PATH=${BLAS_LIBRARY_DIRS}" )
	config_args+=( "-DBLAS_INCLUDE_DIRS:PATH=${BLAS_LIBRARY_DIRS}" )
	config_args+=( "-DBLAS_LIBRARY_NAMES:STRING=${BLAS_LIBRARY_NAMES}" )
	config_args+=( "-DLAPACK_LIBRARY_DIRS:PATH=${LAPACK_LIBRARY_DIRS}" )
	config_args+=( "-DLAPACK_INCLUDE_DIRS:PATH=${LAPACK_INCLUDE_DIRS}" )
	config_args+=( "-DLAPACK_LIBRARY_NAMES:STRING=${LAPACK_LIBRARY_NAMES}" )

	if (( V_MAJOR == 12 && V_MINOR >= 12)); then
		config_args+=( "-DTrilinos_ENABLE_SEACAS:BOOL=OFF" )
    		config_args+=( "-DTrilinos_ENABLE_OpenMP:BOOL=OFF" )
    		config_args+=( "-DKokkos_ENABLE_Serial:BOOL=ON" )
		config_args+=( "-DKokkos_ENABLE_OpenMP:BOOL=OFF" )
		config_args+=( "-DKokkos_ENABLE_Pthread:BOOL=OFF" )
		config_args+=( "-DKokkos_ENABLE_Cuda:BOOL=OFF" )
		config_args+=( "-DKokkos_ENABLE_Cuda_UVM:BOOL=OFF" )
		config_args+=( "-DTpetra_INST_SERIAL:BOOL=ON" )
		config_args+=( "-DTrilinos_ENABLE_TESTS:BOOL=OFF" )
		config_args+=( "-DTrilinos_ENABLE_MueLu:BOOL=ON" )
	fi

	PARMETIS_INCLUDE_DIRS="${PARMETIS_PREFIX}/include"
	PARMETIS_LIBRARIES="${PARMETIS_PREFIX}/lib/libparmetis.a"
	METIS_INCLUDE_DIRS="${PARMETIS_PREFIX}/include/metis"
	METIS_LIBRARIES="${PARMETIS_PREFIX}/lib/libmetis.a"

	cmake \
           -D CMAKE_BUILD_TYPE:STRING=Release \
           -D CMAKE_INSTALL_PREFIX:PATH=$PREFIX \
           -D CMAKE_CXX_FLAGS:STRING="-DMPICH_IGNORE_CXX_SEEK -fPIC" \
           -D CMAKE_C_FLAGS:STRING="-DMPICH_IGNORE_CXX_SEEK -fPIC" \
	   -D CMAKE_CXX_STANDARD:STRING="14" \
           -D CMAKE_Fortran_FLAGS:STRING="-fPIC" \
           -DTPL_ENABLE_DLlib:BOOL=OFF \
           -DTPL_ENABLE_QT:BOOL=OFF \
           -DTPL_ENABLE_MPI:BOOL=ON \
           -DTPL_ENABLE_BLAS:BOOL=ON \
           -DTPL_ENABLE_LAPACK:BOOL=ON \
           -DTPL_ENABLE_METIS:BOOL=ON \
           -DTPL_ENABLE_ParMETIS:BOOL=OFF \
           -DTrilinos_ENABLE_Amesos:BOOL=ON \
           -DTrilinos_ENABLE_Amesos2:BOOL=ON \
           -DTrilinos_ENABLE_AztecOO:BOOL=ON \
           -DTrilinos_ENABLE_Belos:BOOL=ON \
           -DTrilinos_ENABLE_Epetra:BOOL=ON \
           -DTrilinos_ENABLE_EpetraExt:BOOL=ON \
           -DTrilinos_ENABLE_Galeri:BOOL=ON \
           -DTrilinos_ENABLE_Ifpack:BOOL=ON \
           -DTrilinos_ENABLE_Isorropia:BOOL=ON \
           -DTrilinos_ENABLE_ML:BOOL=ON \
           -DTrilinos_ENABLE_NOX:BOOL=ON \
           -DTrilinos_ENABLE_Optika:BOOL=OFF \
           -DTrilinos_ENABLE_Teuchos:BOOL=ON \
           -DTrilinos_ENABLE_Tpetra:BOOL=ON \
           -DTrilinos_ENABLE_TESTS:BOOL=OFF \
           -DTPL_METIS_INCLUDE_DIRS:PATH=$METIS_INCLUDE_DIRS \
           -DTPL_METIS_LIBRARIES:PATH=$METIS_LIBRARIES \
           -DTPL_ParMETIS_INCLUDE_DIRS:PATH=$PARMETIS_INCLUDE_DIRS \
           -DTPL_ParMETIS_LIBRARIES:PATH=$PARMETIS_LIBRARIES \
	   "${config_args[@]}" \
           "${SRC_DIR}" || exit 1
}


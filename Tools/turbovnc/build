#!/usr/bin/env modbuild

pbuild::configure() {
    arch="$(uname -m)"
    rpm_file="${SRC_DIR}/${P}-${V_PKG}.${arch}.rpm"
    url="https://github.com/TurboVNC/${P}/releases/download/${V_PKG}/${P}-${V_PKG}.${arch}.rpm"

    echo "==> Downloading ${url}"
    wget -q --show-progress -O "${rpm_file}" "${url}"

    echo "==> Extracting ${rpm_file}"
    rpm2cpio "${rpm_file}" | cpio -idmv

    echo "==> Cleaning up"
    rm -f "${rpm_file}"
}

pbuild::compile() {
    :
}

pbuild::install() {
    echo "==> Installing TurboVNC"

    cp -r "${BUILD_DIR}/." "${PREFIX}/"

    mkdir -p "${PREFIX}/bin"

    if [ -d "${PREFIX}/opt/TurboVNC/bin" ]; then
        find "${PREFIX}/opt/TurboVNC/bin" -type f -executable -exec ln -sf {} "${PREFIX}/bin/" \;
    else
        echo "Error: TurboVNC binaries not found in ${PREFIX}/opt/TurboVNC/bin" >&2
        exit 1
    fi
}


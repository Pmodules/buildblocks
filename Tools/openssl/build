#!/usr/bin/env modbuild

pbuild::set_download_url "https://www.openssl.org/source/$P-$V.tar.gz"

# use system gcc to compile
declare -rx CC=gcc

pbuild::add_to_group 'Tools'
pbuild::compile_in_sourcetree

pbuild::pre_configure_Darwin() {
	pbuild::add_configure_args 'darwin64-x86_64-cc'
}

pbuild::pre_configure_Linux() {
	pbuild::add_configure_args 'linux-x86_64'
}

pbuild::configure() {
	export CFLAGS='-fPIC'
	"${SRC_DIR}"/Configure shared --prefix="${PREFIX}" "${CONFIGURE_ARGS[@]}" \
		|| exit 1
}

